<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using the Wikipedia API via the wikipedia-query tag</title>
    <meta name="description" content="Second lab post for IST 402 on using an API.">
    <link rel="stylesheet" href="/11ty-template-blog/css/index.css">
    <link rel="stylesheet" href="/11ty-template-blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/11ty-template-blog/feed/feed.xml" type="application/atom+xml" title="John&#39;s IST 402 Blog">
    <link rel="alternate" href="/11ty-template-blog/feed/feed.json" type="application/json" title="John&#39;s IST 402 Blog">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/11ty-template-blog/">John&#39;s IST 402 Blog</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/11ty-template-blog/">Home</a></li>
        <li class="nav-item"><a href="/11ty-template-blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/11ty-template-blog/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <!-- Delete this message -->
      
      <!-- Stop deleting -->

      <h1>Using the Wikipedia API via the wikipedia-query tag</h1>

<time datetime="2022-01-30">30 Jan 2022</time><a href="/11ty-template-blog/tags/labs/" class="post-tag">labs</a>

<p>While familiar with them, prior to this week in class I had never used an API. APIs are useful tools that enable developers to connect to another service, Wikipedia in the case of this blog post, and communicate data.</p>
<h2 id="fetch" tabindex="-1">Fetch <a class="direct-link" href="#fetch" aria-hidden="true">#</a></h2>
<p><code>fetch</code> is a JavaScript interface for making HTTP requests and receiving responses. It is a common way to retrieve data over the internet via APIs. In this lab, using <code>fetch</code> enables me to make an HTTP GET request for information from the Wikipedia API and send the response to be rendered by a web component. Take a look at how <code>fetch</code> is used in the wikipedia-query.js file:</p>
<pre class="language-js"><code class="language-js"><span class="token function">updateArticle</span><span class="token punctuation">(</span><span class="token parameter">search<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> language</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">fetch</span><span class="token punctuation">(</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>language<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.wikipedia.org/w/api.php?origin=*&amp;action=query&amp;titles=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>search<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;prop=extracts&amp;format=json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>      headers<br>    <span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleResponse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span></code></pre>
<p>After sending the request to the Wikipedia API (which I'll go over next) the resulting JSON response is sent to a LitElement to be rendered in HTML.</p>
<p>The DOM is updated when variables are updated and may require the page to be re-rendered with new data. <code>fetch</code> can be used to assign variables data from an API. When the API is called and the variables are updated, the DOM is updated and the page is re-rendered.</p>
<h2 id="wikipedia-api" tabindex="-1">Wikipedia API <a class="direct-link" href="#wikipedia-api" aria-hidden="true">#</a></h2>
<p>The Wikipedia API allows developers to connect to Wikipedia and search or manage wiki entries. While the API has several actions, in this lab specifically I am using the query function. According to the <a href="https://www.mediawiki.org/wiki/API:Query">API documentation</a>: &quot;The <code>action=query</code> module allows you to fetch information about a wiki and the data stored in it, such as the wikitext of a particular page, the links and categories of a set of pages, or the token you need to change wiki content.&quot; This lab is specifically querying for extracts of the specified pages.</p>
<p>To use the API in this lab, I placed the <code>wikipedia-query</code> tag in the LocationFromIP.js file that is responsible for retrieving the location of the user who opens the page and rendering it on an embedded Google Map. I took the city and state data from the location API and stored it in two objects.</p>
<p>I placed three tags at the bottom of the render function for the map iframe and link.</p>
<pre class="language-js"><code class="language-js"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://maps.google.com/maps?q=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>lat<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>long<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;t=&amp;z=15&amp;ie=UTF8&amp;iwloc=&amp;output=embed</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>      &lt;iframe title="Where you are" src="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">&lt;/iframe><br>      &lt;p><br>        &lt;a href="https://www.google.com/maps/@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>lat<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>long<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,14z"<br>          >https://www.google.com/maps/@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>lat<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>long<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,14z&lt;/a<br>        ><br>      &lt;/p><br>      &lt;wikipedia-query search="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">&lt;/wikipedia-query><br>      &lt;wikipedia-query search="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">&lt;/wikipedia-query><br>      &lt;wikipedia-query search="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">&lt;/wikipedia-query><br>    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>The way the Wikipedia API works in this lab starts with the <code>wikipedia-query</code> tag. The location value is sent to the API as the search value for the <code>fetch</code>. After receiving the request, the API searches for a wiki page that matches the title sent. If a match is found, a JSON response is sent containing HTML extracts for that wiki page. An example JSON response for State College, Pennsylvania is shown below:</p>
<pre class="language-json"><code class="language-json">batchcomplete<span class="token string">": "</span>"<span class="token punctuation">,</span><br><span class="token property">"warnings"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br><span class="token property">"extracts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br><span class="token property">"*"</span><span class="token operator">:</span> "HTML may be malformed and/or unbalanced and may omit <br>inline images. Use at your own risk. Known problems are <br>listed at <br>https<span class="token operator">:</span><span class="token comment">//www.mediawiki.org/wiki/Special:MyLanguage/Extension:TextExtracts#Caveats."</span><br><span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br><span class="token property">"pages"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br><span class="token property">"131800"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br><span class="token property">"pageid"</span><span class="token operator">:</span> <span class="token number">131800</span><span class="token punctuation">,</span><br><span class="token property">"ns"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br><span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"State College, Pennsylvania"</span><span class="token punctuation">,</span><br><span class="token property">"extract"</span><span class="token operator">:</span> "&lt;link rel=\"mw-deduplicated-inline-style\" href=\"mw-data<span class="token operator">:</span>TemplateStyles<span class="token operator">:</span>r1033289096\">\n&lt;p class=\"mw-empty-elt\">\n&lt;/p>\n&lt;p>&lt;b>State College&lt;/b> is a home rule municipality in Centre County in the Commonwealth of Pennsylvania.  It is a college town<span class="token punctuation">,</span> dominated economically and demographically by the presence of the University Park campus of the Pennsylvania State University (Penn State).\n&lt;/p>&lt;p>State College is the largest designated borough in Pennsylvania. It is the principal borough of the six municipalities that make up the State College area<span class="token punctuation">,</span> the largest settlement in Centre County and one of the principal cities of the greater State College-DuBois Combined Statistical Area with a combined population of <span class="token number">236</span><span class="token punctuation">,</span><span class="token number">577</span> as of the <span class="token number">2010</span> United States Census. In the <span class="token number">2010</span> census<span class="token punctuation">,</span> the borough population was <span class="token number">42</span><span class="token punctuation">,</span><span class="token number">034</span> with approximately <span class="token number">105</span><span class="token punctuation">,</span><span class="token number">000</span> living in the borough plus the surrounding townships often referred to locally as the \"Centre Region.\" Many of these Centre Region communities also carry a \"State College<span class="token punctuation">,</span> PA\" address although they are not part of the borough of State College.  \"Happy Valley\" and \"Lion Country\" are other terms used to identify the State College area including the borough as well as the townships of College<span class="token punctuation">,</span> Harris<span class="token punctuation">,</span> Patton<span class="token punctuation">,</span> and Ferguson.\n&lt;/p>\n\n\n&lt;h2>&lt;span id=\"History\">History&lt;/span>&lt;/h2>\n&lt;p>State College evolved from a village to a town to serve the needs of the Pennsylvania State College<span class="token punctuation">,</span> founded as the Farmers' High School of Pennsylvania in <span class="token number">1855</span>. State College was incorporated as a borough on August <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">1896</span><span class="token punctuation">,</span> and has grown with the college<span class="token punctuation">,</span> which was renamed The Pennsylvania State University in <span class="token number">1953</span>.\n&lt;/p>&lt;p>In <span class="token number">1973</span> State College adopted a home rule charter which took effect in <span class="token number">1976</span>; since then<span class="token punctuation">,</span> it has not been governed by the state's Borough Code<span class="token punctuation">,</span> although it retains \"Borough of State College\" as its official name.\n&lt;/p>&lt;p>The university has a post office address of University Park<span class="token punctuation">,</span> Pennsylvania. When Penn State changed its name from College to University in <span class="token number">1953</span><span class="token punctuation">,</span> its president<span class="token punctuation">,</span> Milton S. Eisenhower<span class="token punctuation">,</span> sought to persuade the town to change its name as well. A referendum failed to yield a majority for any of the choices for a new name<span class="token punctuation">,</span> and so the town remains State College. After this<span class="token punctuation">,</span> Penn State requested a new name for its on-campus post office in the HUB-Robeson Center from the U.S. Post Office Department. The post office<span class="token punctuation">,</span> which has since moved across an alley to the McAllister Building<span class="token punctuation">,</span> is the official home of ZIP code <span class="token number">16802</span> (University Park)...</code></pre>
<p>The response is rendered in HTML to be displayed on the page.</p>
<p>This API is a useful tool for people trying to access information about anything Wikipedia has a wiki on. You can check out the API documentation <a href="https://en.wikipedia.org/w/api.php">here</a>. Take a look at the source code for this lab in my <a href="https://github.com/jforcina20/ip-project/blob/master/src/LocationFromIP.js">github repository</a> to learn more about how I completed it.</p>

<hr>
<ul><li>Previous: <a href="/11ty-template-blog/posts/firstpost/">Getting started with Web Components.</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /11ty-template-blog/posts/secondpost/ -->
  </body>
</html>
